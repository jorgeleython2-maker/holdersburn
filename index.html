<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to burn • $sdgsdg</title>
  <link rel="icon" href="https://i.ibb.co.com/0jZ6g3f/fire.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--o:#FF6B00;--r:#FF0000;--d:#111;--b:#000}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Inter,sans-serif;background:var(--b);color:#fff}
    .c{max-width:1200px;margin:auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;padding:25px 0;border-bottom:1px solid #333}
    .t{display:flex;align-items:center;gap:18px}
    .i{width:70px;height:70px;border-radius:50%;border:3px solid var(--o);box-shadow:0 0 20px rgba(255,107,0,.4)}
    h1{font-size:32px;font-weight:800;background:linear-gradient(90deg,#fff,var(--o));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .cb{background:var(--o);color:#fff;border:none;padding:14px 28px;border-radius:12px;cursor:pointer;font-weight:bold}
    .uw,.dw{text-align:center;margin:25px 0;padding:18px;background:rgba(255,107,0,.1);border-radius:16px;color:var(--o);font-weight:bold;border:1px solid rgba(255,107,0,.2)}
    .uw{display:none;background:rgba(255,107,0,.15);font-size:20px}
    .cs{text-align:center;margin:60px 0}
    .j{font-size:42px;font-weight:800;color:var(--o);text-shadow:0 0 20px rgba(255,107,0,.5)}
    .ti{font-size:32px;margin:25px 0;color:var(--o);font-weight:bold}
    .sb{background:var(--r);color:#fff;border:none;padding:22px 60px;font-size:28px;border-radius:16px;cursor:pointer;font-weight:bold;box-shadow:0 10px 30px rgba(255,0,0,.4)}
    .m{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.97);justify-content:center;align-items:center;z-index:9999}
    .mc{background:var(--d);padding:50px 30px;border-radius:20px;max-width:420px;width:90%;border:3px solid var(--o);position:relative}
    .x{position:absolute;top:15px;right:25px;font-size:36px;cursor:pointer;color:#aaa}
    .p button{background:#333;color:#fff;border:none;padding:14px 22px;border-radius:12px;margin:6px;cursor:pointer;font-weight:bold}
    input{width:100%;padding:20px;margin:20px 0;border-radius:14px;background:#222;color:#fff;font-size:20px;text-align:center;border:none}
    .bb{background:var(--r);color:#fff;border:none;padding:22px;width:100%;font-size:26px;border-radius:16px;cursor:pointer;font-weight:bold}
  </style>
</head>
<body>
  <div class="c">
    <header>
      <div class="t">
        <img id="l" src="https://i.ibb.co.com/0jZ6g3f/fire.png" class="i">
        <div>
          <h1 id="n">Welcome to burn • $sdgsdg</h1>
          <p>Burn-to-Win Real • Quema tokens y gana SOL cada 20 segundos</p>
        </div>
      </div>
      <button id="w" class="cb">Connect Wallet</button>
    </header>

    <div class="dw" id="dw">Dev Wallet: Cargando...</div>
    <div class="uw" id="uw">Tienes <strong id="ub">0</strong> $sdgsdg</div>

    <div class="cs">
      <div class="j">Jackpot Actual: <span id="j">0.0000</span> SOL</div>
      <div class="ti">Próximo ganador en: <span id="t">05:00</span></div>
      <button id="ob" class="sb">QUEMAR TOKENS</button>
    </div>
  </div>

  <div id="bm" class="m">
    <div class="mc">
      <span class="x">X</span>
      <h2>QUEMAR TOKENS</h2>
      <div class="p">
        <button data-a="10000">10K</button>
        <button data-a="50000">50K</button>
        <button data-a="100000">100K</button>
        <button data-a="500000">500K</button>
        <button data-a="1000000">1M</button>
      </div>
      <input type="number" id="ca" placeholder="Cantidad exacta">
      <button id="bn" class="bb">QUEMAR & PARTICIPAR</button>
    </div>
  </div>

  <!-- LIBRERÍAS + APP EN UN SOLO BLOQUE (FUNCIONA EN VERCEL 100%) -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.91.1/dist/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>
  <script>
    // Esperar que las librerías estén listas (nunca falla)
    const wait = () => new Promise(r => {
      const check = () => window.solanaWeb3 && window.splToken ? r() : setTimeout(check, 100);
      check();
    });

    (async () => {
      await wait();
      const conn = new solanaWeb3.Connection("https://rpc.ankr.com/solana");
      const BACKEND = "https://spin-production-ddc0.up.railway.app";
      let wallet = null;
      let mint = "E1kjpery9wkprYe9phhwSHKtCmQwMNaoy6soa3Wfpump";

      // Presets
      document.querySelectorAll('[data-a]').forEach(b => b.onclick = () => document.getElementById('ca').value = b.dataset.a);

      // Connect
      document.getElementById('w').onclick = async () => {
        if (!window.solana?.isPhantom) return alert("Instala Phantom");
        try {
          await window.solana.connect();
          wallet = window.solana.publicKey.toString();
          document.getElementById('w').innerText = wallet.slice(0,6)+"..."+wallet.slice(-4);
          load();
        } catch(e) {}
      };

      // Cargar token
      async function load() {
        try {
          const t = await (await fetch(`${BACKEND}/api/token`)).json();
          if (t.mint) mint = t.mint;
          document.getElementById('n').innerHTML = `Welcome to burn • $${t.symbol||'sdgsdg'}`;
          document.getElementById('l').src = t.image || "https://i.ibb.co.com/0jZ6g3f/fire.png";
          document.getElementById('dw').innerHTML = `Dev Wallet: <strong>${(t.creator||'').slice(0,6)}...${(t.creator||'').slice(-4)}</strong>`;
          if (wallet) bal();
        } catch(e) { setTimeout(load, 5000); }
      }

      // Balance
      async function bal() {
        try {
          const a = await conn.getTokenAccountsByOwner(new solanaWeb3.PublicKey(wallet), { mint: new solanaWeb3.PublicKey(mint) });
          const b = a.value.length ? Number(a.value[0].account.data.parsed.info.tokenAmount.uiAmount)||0 : 0;
          document.getElementById('ub').innerText = b.toLocaleString();
          document.getElementById('uw').style.display = "block";
        } catch(e) { setTimeout(bal, 3000); }
      }

      // Quemar
      document.getElementById('bn').onclick = async () => {
        if (!wallet) return alert("Conecta tu wallet");
        const amt = parseFloat(document.getElementById('ca').value);
        if (!amt || amt <= 0) return alert("Cantidad inválida");

        try {
          const m = new solanaWeb3.PublicKey(mint);
          const o = new solanaWeb3.PublicKey(wallet);
          const ata = await splToken.getAssociatedTokenAddress(m, o);

          const tx = new solanaWeb3.Transaction();
          if (!await conn.getAccountInfo(ata)) tx.add(splToken.createAssociatedTokenAccountInstruction(o, ata, o, m));
          tx.add(splToken.createBurnInstruction(ata, m, o, BigInt(amt*1e9), [], splToken.TOKEN_PROGRAM_ID));

          tx.feePayer = o;
          tx.recentBlockhash = (await conn.getLatestBlockhash()).blockhash;

          const signed = await window.solana.signTransaction(tx);
          const sig = await conn.sendRawTransaction(signed.serialize());
          await conn.confirmTransaction(sig);

          alert(`QUEMADOS ${amt.toLocaleString()}!\nhttps://solscan.io/tx/${sig}`);
          document.getElementById('ca').value = "";
          bal();
        } catch(err) {
          alert("Error: " + (err.message || "Cancelado"));
        }
      };

      // Modal + Timer
      document.getElementById('ob').onclick = () => document.getElementById('bm').style.display = "flex";
      document.querySelector('.x').onclick = () => document.getElementById('bm').style.display = "none";

      let time = 300;
      setInterval(() => {
        time--; if (time<=0) time=300;
        const m = String(Math.floor(time/60)).padStart(2,"0");
        const s = String(time%60).padStart(2,"0");
        document.getElementById('t').innerText = m+":"+s;
      }, 1000);

      load();
      setInterval(load, 10000);
    })();
  </script>
</body>
</html>